"use strict";(("undefined"!=typeof self?self:global).webpackChunkopen=("undefined"!=typeof self?self:global).webpackChunkopen||[]).push([[4338],{65753:(e,s,i)=>{i.r(s),i.d(s,{default:()=>Fs});var t=i(67294),a=i(47647),n=i(74257),r=i(46802),c=i(96206),l=i(23701),d=i(27968),o=i(1416),u=i(20729),m=i(88330),f=i(26492),g=i(51674),h=i(8716),x=i(32648),b=i(15852),j=i(98197),y=i(32667),p=i(34011),N=i(35032),v=i(22595),k=i(73753),C=i(22867);let w;!function(e){e[e.LOADING=0]="LOADING",e[e.CONNECTED=1]="CONNECTED",e[e.DISCONNECTED=2]="DISCONNECTED"}(w||(w={}));var E=i(24697),I=i(44295),S=i(22247),D=i(88767);var O=i(94184),L=i.n(O),T=i(39714),F=i(91552),_=i(22647),B=i(50266),U=i(1646);const A="w5nHQ74JGTytKwWanjvB",P="u11kJflcqt7CSXo9qL_T",z="MmENkh6tW0MyjTtTtPHZ",M="Gl0dkNQbAyNjVZ1IpghI";var R=i(85893);const Z=({name:e,following:s,imageUrl:i,uri:n})=>{const r=(0,B.q)(),l=(0,f.o)(),d=t.createRef(),[o,u]=(0,t.useState)(s);(0,U.d)(_.rA.OPERATION_COMPLETE,(e=>{if(e.data.uris.includes(n))switch(e.data.operation){case _.BM.FOLLOW_USER:u(!0);break;case _.BM.UNFOLLOW_USER:u(!1)}}));const m=(0,t.useCallback)((()=>{o?r.unfollowUsers([n]):(r.followUsers([n]),l({intent:"follow",type:"click",itemIdSuffix:"buddyfeed"})),d.current&&d.current.blur()}),[o,d,n,r,l]);return(0,R.jsxs)("div",{className:A,children:[(0,R.jsx)(F.q,{label:e,width:40,userIconSize:16,images:(0,t.useMemo)((()=>[{width:40,height:40,url:i}]),[i])}),(0,R.jsxs)("div",{className:L()(P,"ellipsis-one-line"),children:[(0,R.jsx)(y.D,{as:"p",variant:"mestoBold",className:"ellipsis-one-line",children:e}),o&&(0,R.jsx)(y.D,{as:"p",variant:"finale",className:"ellipsis-one-line",children:c.ag.get("following")})]}),(0,R.jsx)("div",{className:z,children:(0,R.jsx)(h.E,{className:M,size:"sm",ref:d,onClick:m,ariaLabel:o?c.ag.get("buddy-feed.button.remove-friend"):c.ag.get("buddy-feed.button.add-friend"),icon:o?T.k:a.t})})]})},K="nGInMrf62TCFD9MBnEzz";function Y({facebookFriends:e}){return(0,R.jsx)("div",{className:K,children:e.map((({uri:e,following:s,title:i,image:t})=>(0,R.jsx)(Z,{uri:e,name:i,imageUrl:t,following:s},`fb-friend-${e}`)))})}const H="n6rSk6R7nfmSGSgTRR5_";function q(){return(0,R.jsx)("div",{className:H,children:Array(20).fill(0).map(((e,s)=>(0,R.jsx)(S.C,{isLoading:!0,charCount:100,as:"p",variant:"canon"},s)))})}const Q="pZFwflwH1vXVCmAO5vbz",W="yPL55nV5rC97vJhAf7ke",J="qpgo9DQ9rVZbO5pLJog5",G="A3hvkJOGkBNa6zWj6oZa",V="pIyez6N1SF3jW0U5VUx4",X="lIxuZR4lYTrEKkMYedty",$="VEmC3OHK3uAasHvO5OuA",ee="wzGPtuvvLpOpY1PDu4Qv",se="YoJTUV4hazVCFNbfKoNq",ie=({onBackButtonClick:e})=>{const[s,i]=(0,t.useState)(""),{isLoading:a,friends:n}=(e=>{const s=(0,C.I)(),i=e.trim().toLowerCase(),{data:t,isLoading:a}=(0,D.useQuery)("useFacebookFriends",(async()=>(await s.fetchFacebookFriends()).sort(((e,s)=>e.title>s.title?1:-1))));return{isLoading:a,friends:t?.filter((({title:e})=>-1!==e.trim().toLowerCase().indexOf(i)))??[]}})(s),r=(0,E.y1)((e=>{i(e.target.value)}),100),l=(0,t.useCallback)((e=>{null!==e&&e.focus()}),[]);return(0,R.jsxs)("div",{className:Q,children:[(0,R.jsx)(h.E,{ariaLabel:c.ag.get("buddy-feed.button.back"),onClick:e,ref:l,className:W,icon:j.e,size:"sm",testId:"back-to-friends"}),(0,R.jsxs)("div",{className:J,children:[(0,R.jsx)("div",{className:G,children:(0,R.jsx)(N.z,{className:V,iconSize:32})}),(0,R.jsx)("div",{className:X,children:a?(0,R.jsx)(S.C,{isLoading:!0,charCount:25,as:"p",variant:"mesto"}):(0,R.jsx)(y.D,{as:"p",variant:"mesto",children:c.ag.get("buddy-feed.number-of-friends",n.length)})})]}),a?(0,R.jsx)(q,{}):(0,R.jsxs)(R.Fragment,{children:[(0,R.jsxs)("div",{className:$,children:[(0,R.jsx)(I.j,{className:se,iconSize:16,role:"presentation"}),(0,R.jsx)("input",{onChange:r,className:ee,placeholder:c.ag.get("buddy-feed.find-in-playlists")})]}),(0,R.jsx)(Y,{facebookFriends:n})]})]})};var te=i(57492);function ae({isOpen:e,onClose:s,onConfirm:i}){return(0,R.jsx)(te.Q,{onClose:s,"aria-label":c.ag.get("web-player.buddy-feed.connect-with-facebook-title"),onConfirm:i,titleText:c.ag.get("web-player.buddy-feed.connect-with-facebook-title"),descriptionText:c.ag.get("web-player.buddy-feed.connect-with-facebook-description"),cancelText:c.ag.get("queue.cancel-button"),confirmText:c.ag.get("web-player.buddy-feed.connect-button"),isOpen:e})}const ne="EmZCbU1_B_J9RAHebolL",re="Ym6Yyx83U7mNKOMw9dxw",ce="NXcZaSipzomJ6d4_nM94",le="b9rqRkvRvhrSY4FYHQVC",de="xHc_2FQr3NxfCgfDSVhY",oe="QAJYN0xWh3h2A5d8_C1g",ue="PKhH1CknobkjJdVITsb4",me="HgRmCE3NxfiYNtv6pF3H",fe="HnA5mipUMkheAlbxqCn_",ge="mvp0xhvZTo0xv0TIwi9u",he=e=>{const s=(0,f.o)(),{onBackButtonClick:i,feedIsEmpty:a,goToAddFriends:n=!1}=e,r=function(){const e=(0,C.I)(),[s,i]=(0,t.useState)(w.LOADING);return(0,t.useEffect)((()=>e.subscribeToFacebookConnectionState((e=>{i(e.connection?w.CONNECTED:w.DISCONNECTED)})).cancel),[e]),s}(),l=(0,C.I)(),[d,o]=(0,t.useState)(!1),[u,m]=(0,t.useState)(!1),[g,x]=(0,t.useState)(!1),b=(0,t.useCallback)((e=>{null!==e&&e.focus()}),[]);if(u)return(0,R.jsxs)("div",{className:fe,children:[(0,R.jsx)(h.E,{onClick:i,ref:b,className:ce,ariaLabel:c.ag.get("buddy-feed.button.back"),icon:j.e,size:"sm"}),(0,R.jsxs)("div",{className:ge,children:[(0,R.jsx)(y.D,{as:"h1",variant:"balladBold",className:re,children:c.ag.get("error-dialog.generic.header")}),(0,R.jsx)(y.D,{as:"p",variant:"mesto",className:le,children:c.ag.get("error-dialog.generic.body")}),(0,R.jsx)(p.D,{colorSet:"invertedLight",onClick:location.reload,children:c.ag.get("error.reload")})]})]});const E=(n||g)&&r===w.CONNECTED;return(0,R.jsxs)("div",{className:ne,children:[E&&(0,R.jsx)(ie,{onBackButtonClick:()=>{a&&x(!1),i()}}),!E&&(0,R.jsxs)("div",{className:oe,children:[(0,R.jsx)(h.E,{ariaLabel:c.ag.get("buddy-feed.button.back"),onClick:i,className:ce,ref:b,icon:j.e,size:"sm"}),(0,R.jsx)(y.D,{as:"h1",variant:"balladBold",className:re,children:c.ag.get("buddy-feed.friend-activity")}),(0,R.jsx)(y.D,{as:"p",variant:"mesto",className:le,children:c.ag.get("buddy-feed.facebook.connect-with-friends-default")}),(0,R.jsx)("div",{className:ue,children:(0,R.jsx)(p.D,{className:me,buttonSize:"sm",iconLeading:N.z,UNSAFE_colorSet:(0,v.Ev)("#2374E1",k.$_Y.white),onClick:()=>{s({intent:"connect-to-facebook",type:"click",itemIdSuffix:"buddyfeed"}),r!==w.CONNECTED?o(!0):x(!0)},children:c.ag.get("buddy-feed.facebook.button")})}),(0,R.jsx)(y.D,{as:"p",variant:"finale",className:de,children:c.ag.get("buddy-feed.facebook.disclaimer")}),(0,R.jsx)(ae,{isOpen:d,onClose:()=>{o(!1)},onConfirm:()=>{l.connectToFacebook().then((()=>{x(!0),o(!1)})).catch((()=>{m(!0)}))}})]})]})};var xe=i(73727),be=i(38370);const je="main-buddyFeed-username",ye="main-buddyFeed-friendActivity",pe="SQHCRmgNjRywo1Lt7rP3",Ne="SCwzmMSXoZsmhGtGX81s",ve="VLKqDIGaQn2bILzJKSZ0",ke="main-buddyFeed-friendsFeedContainer",Ce="main-buddyFeed-avatarContainer",we="main-buddyFeed-overlay",Ee="Irsd58UNEmDPxdhXKXCs",Ie="main-buddyFeed-activityMetadata",Se="main-buddyFeed-usernameAndTimestamp",De="main-buddyFeed-timestamp",Oe="main-buddyFeed-artistAndTrackName",Le="main-buddyFeed-playbackContextIcon",Te="main-buddyFeed-playbackContext",Fe="main-buddyFeed-playbackContextLink",_e="main-buddyFeed-addFriendPlaceholder",Be="main-buddyFeed-addFriendPlaceholderBtn",Ue="MObmOrMxbQpO10ebAtZA",Ae="cBPbfBWIIPDzhIT6i3ih",Pe="PjDcsgAPmXlcTBJRGpIu",ze="IRpPQFA57qgQ5jicWWaD",Me="Hm3nIbegLclY1uCAmnx_",Re="bhRoVUHjWdo9mgUkU6fe",Ze="BliqfY7vu_qE2C9zs5Ou",Ke="qdYWuHZd4HdSWfd4pSQB",Ye="DhvYWKjDc7uyF3HfkDJJ",He="ralK8s_OmE8a8zWcfNKM",qe=({showOnlineIndicator:e})=>(0,R.jsxs)("div",{className:Pe,children:[(0,R.jsxs)("div",{className:ze,children:[(0,R.jsx)(be.f,{iconSize:24}),e?(0,R.jsx)("div",{className:Me}):null]}),(0,R.jsxs)("div",{className:Re,children:[(0,R.jsx)("div",{className:L()(Ze,Ke)}),(0,R.jsx)("div",{className:Ze}),(0,R.jsx)("div",{className:Ze})]})]}),Qe=()=>(0,R.jsxs)("div",{"data-testid":"buddy-feed-empty-state",className:Ue,children:[(0,R.jsx)(y.D,{as:"p",className:Ae,children:c.ag.get("buddy-feed.let-followers-see-your-listening")}),(0,R.jsx)(qe,{showOnlineIndicator:!0}),(0,R.jsx)(qe,{showOnlineIndicator:!0}),(0,R.jsx)(qe,{}),(0,R.jsx)(y.D,{as:"p",className:Ae,children:c.ag.get("buddy-feed.enable-share-listening-activity")}),(0,R.jsx)(xe.rU,{to:"/preferences",className:Ye,children:(0,R.jsx)(p.D,{colorSet:"invertedLight",className:He,children:c.ag.get("desktop.settings.settings")})})]});var We=i(94537),Je=i(61075);const Ge="jUF2eKgYMm64aYykubct",Ve="zhL_lhJqzKfJVy7L5VuY",Xe="XqquM_o2eODcnD8Y4QhS",$e="UGtycHBJ4egymBSmD_lX",es="ND2ydDPzwQZB7HyaGCN8",ss="D9YN554UFGJle2CPP1TA",is="v7Zcy9UKVUTDZIMKB6ZF",ts="RX3U6eAasqazEkuFdnj0",as=({children:e,page:s})=>{const i=0===s,t=e.filter(((e,i)=>i!==s));return(0,R.jsx)(We.Z,{component:null,children:t.map((e=>(0,R.jsx)(Je.Z,{in:i,timeout:500,classNames:{enter:i?Ge:es,enterActive:i?Ve:ss,exit:i?Xe:is,exitActive:i?$e:ts},children:e},i?"first-page":"second-page")))})};function ns(e){return e.sort(((e,s)=>s.timestamp-e.timestamp))}function rs(e,s){return s.some((s=>s.user.uri===e.user.uri))?s:ns([...s,e])}function cs(e,s){return s.filter((s=>s.user.uri!==e))}var ls=i(69518),ds=i.n(ls);function os(e){const s=(0,C.I)(),[i,a]=(0,t.useState)(ns(e)),{subscribeToFriend:n,unSubscribeFromFriend:r}=function(e,s){const i=(0,C.I)(),a=(0,t.useRef)(e),n=(0,t.useRef)({}),r=(0,t.useRef)(s);r.current=s;const c=(0,t.useCallback)((e=>{const s=ds().from(e)?.username;return i.subscribeToBuddyActivity(s,(e=>{e&&r.current(e)}))}),[i]),l=(0,t.useCallback)((e=>{n.current[e]?.cancel(),delete n.current[e]}),[]);return(0,t.useEffect)((()=>{n.current=a.current.reduce(((e,s)=>{const i=s.user.uri,t=c(i);return e[i]=t,e}),{})}),[c]),(0,t.useEffect)((()=>{const e=n.current;return()=>{Object.values(e).forEach((e=>{e.cancel()}))}}),[]),{subscribeToFriend:c,unSubscribeFromFriend:l}}(e,(e=>{a((s=>function(e,s){return ns(s.map((s=>s.user.uri===e.user.uri?e:s)))}(e,s)))}));return(0,U.d)(_.rA.OPERATION_COMPLETE,(async e=>{const t=e.data.uris;if(e.data.operation!==_.BM.FOLLOW_USER){if(e.data.operation===_.BM.UNFOLLOW_USER)for(const e of t)i.find((s=>s.user.uri===e))&&(r(e),a((s=>cs(e,s))))}else for(const e of t)if(!i.find((s=>s.user.uri===e))){const i=(await s.fetchFriendActivity([e]))[0];a((e=>rs(i,e))),n(e)}})),i}var us=i(12690),ms=i(4232),fs=i(80507),gs=i(35410),hs=i(86514),xs=i(88214),bs=i(43480),js=i(67892),ys=i(83813),ps=i(57784),Ns=i(18261),vs=i(49343),ks=i(42922),Cs=i(84242),ws=i(634),Es=i(83692);const Is=e=>{if(!Number.isInteger(e))return"";const s=Date.now()-Number(e),i=Math.round(s/1e3/60),t=Math.round(s/1e3/60/60),a=Math.round(s/1e3/60/60/24),n=Math.round(s/1e3/60/60/24/7);return a>=7?c.ag.get("time.weeks.short",n):t>=24?c.ag.get("time.days.short",a):i>=60?c.ag.get("time.hours.short",t):i>0?c.ag.get("time.minutes.short",i):c.ag.get("time.now")},Ss=e=>{const{timestamp:s,isNowPlaying:i}=e;return i?(0,R.jsx)(Es.w,{label:c.ag.get("time.now"),children:(0,R.jsx)(ws.h,{"aria-label":c.ag.get("time.now"),iconSize:16})}):(0,R.jsx)("span",{children:Is(s)})},Ds=e=>Date.now()-e<9e5,Os=(e,s)=>{const i=ds().from(e)?.type;switch(i){case ds().Type.PLAYLIST:case ds().Type.PLAYLIST_V2:return(0,R.jsx)(gs.X,{uri:e});case ds().Type.EPISODE:case ds().Type.SHOW:return(0,R.jsx)(hs.M,{uri:e});case ds().Type.ALBUM:return(0,R.jsx)(ms.Y,{uri:e,artistUri:s});case ds().Type.ARTIST:return(0,R.jsx)(fs.m,{uri:e});default:return null}},Ls=e=>{const{show:s=!0,spec:i,friend:a}=e,n=(0,t.useMemo)((()=>a.user.imageUrl?[{url:a.user.imageUrl,width:0,height:0}]:[]),[a.user.imageUrl]),r=(0,f.o)(),l=(0,b.$P)(),d=a.track,o=d.uri,u=d?.context?.uri,{usePlayContextItem:m}=(0,Cs.n)({uri:u},{featureIdentifier:"buddy_feed",referrerIdentifier:"buddy_feed"}),{togglePlay:g,isPlaying:h,isActive:x}=m({uri:o}),j=(0,t.useCallback)((()=>{g(),r({intent:h?"pause":"play",type:"click",itemIdSuffix:"buddyfeed_play",targetUri:o});const e=i.friendRowFactory().playButtonFactory();x?h?l.logInteraction(e.hitPause({itemToBePaused:o})):l.logInteraction(e.hitResume({itemToBeResumed:o})):l.logInteraction(e.hitPlay({itemToBePlayed:o}))}),[g,r,h,o,i,x,l]),p=(0,t.useCallback)(((e,s)=>{l.logInteraction(i.friendRowFactory().friendRowLinkFactory({identifier:e}).hitUiNavigate({destination:s}))}),[l,i]),N=(0,ps.O1)([o],d.name),v=(0,ps.O1)([d.artist?.uri],d.artist?.name),k=(0,ps.O1)([d.context?.uri],d.context?.name);return s?(0,R.jsxs)("div",{className:L()(ye),children:[(0,R.jsx)(Ns._,{menu:Os(d.context?.uri,d.artist?.uri),children:(0,R.jsxs)("div",{className:Ce,children:[(0,R.jsx)(F.q,{label:a.user.name,width:40,userIconSize:16,images:n,withBadge:Ds(a.timestamp)}),(0,R.jsx)(ys.I,{className:we,iconClassName:Ee,isPlaying:h,isLocked:!1,onClick:j,playAriaLabel:h?c.ag.get("pause"):`${c.ag.get("play")} ${d.artist.name} ${d.name}`})]})}),(0,R.jsxs)("div",{className:L()(Ie),children:[(0,R.jsxs)("div",{className:Se,children:[(0,R.jsx)(y.D,{as:"p",variant:"mestoBold",className:L()(je,"ellipsis-one-line"),children:(0,R.jsx)(ks.ZP,{value:"/buddyfeed_user_profile",children:(0,R.jsx)(Ns._,{menu:(0,R.jsx)(bs.I,{uri:a.user.uri}),children:(0,R.jsx)(js.r,{title:a.user.name,to:a.user.uri,dir:"auto",onClick:()=>p("profile_link",a.user.uri),children:a.user.name})})})}),(0,R.jsx)(y.D,{as:"p",variant:"finale",className:L()(De),children:(0,R.jsx)(Ss,{timestamp:a.timestamp,isNowPlaying:Ds(a.timestamp)})})]}),(0,R.jsxs)(y.D,{as:"p",variant:"finale",className:Oe,children:[(0,R.jsx)(ks.ZP,{value:"/buddyfeed_track",children:(0,R.jsx)(Ns._,{menu:(0,R.jsx)(xs.$,{uri:d.uri,contextUri:d.context?.uri,albumUri:d.album?.uri,artists:[d.artist]}),children:(0,R.jsx)(js.r,{title:d.name,to:o,className:"ellipsis-one-line",dir:"auto",draggable:!0,onDragStart:N,onClick:()=>p("track_link",o),children:d.name})})}),(0,R.jsx)("span",{"aria-hidden":!0,children:" • "}),(0,R.jsx)(ks.ZP,{value:"/buddyfeed_artist",children:(0,R.jsx)(Ns._,{menu:d.artist?(0,R.jsx)(fs.m,{uri:d.artist.uri}):null,children:(0,R.jsx)(js.r,{title:d.artist?.name,to:d.artist?.uri,className:"ellipsis-one-line",dir:"auto",draggable:!0,onDragStart:v,onClick:()=>p("artist_link",d.artist?.uri),children:d.artist?.name})})})]}),(0,R.jsx)(y.D,{as:"p",variant:"finale",className:L()("ellipsis-one-line",Te),children:(0,R.jsx)(ks.ZP,{value:"/buddyfeed_context",children:(0,R.jsx)(Ns._,{menu:Os(d.context?.uri,d.artist?.uri),children:(0,R.jsxs)(js.r,{title:d.context?.name,to:d.context?.uri,className:Fe,draggable:!0,onDragStart:k,onClick:()=>p("context_link",d.context?.uri),children:[(0,R.jsx)(vs.t,{type:ds().from(d.context?.uri)?.type,iconSize:16,className:Le}),(0,R.jsx)("span",{dir:"auto",className:"ellipsis-one-line",children:d.context?.name})]})})})})]})]},a.user.uri):null};function Ts({friends:e,spec:s}){return(0,R.jsx)(us.U5,{flipKey:e.map((e=>e.user.uri)).join(""),children:(0,R.jsx)("ol",{children:e.map(((e,i)=>(0,R.jsx)(us.$3,{flipId:e.user.uri,children:(0,R.jsx)("li",{children:(0,R.jsx)(Ls,{friend:e,show:i<100,spec:s},e.user.uri)})},e.user.uri)))})})}const Fs=({initialFriends:e,className:s})=>{const i=(0,f.o)(),j=(0,l.n)(),y=os(e),p=(0,b.$P)(),{spec:N}=(0,b.fU)(r.createDesktopFriendActivityEventFactory,{});(0,t.useEffect)((()=>{i({intent:"view",type:"impression",itemIdSuffix:"buddyfeed"})}),[i]);const[v,k]=(0,t.useState)(!1),C=()=>{v||p.logInteraction(N.addFriendButtonFactory().hitUiReveal()),k(!v)},w=0===y.length,E=(0,t.useCallback)((()=>{p.logInteraction(N.closeButtonFactory().hitUiHide())}),[p,N]);return(0,R.jsx)(x.DJ.Provider,{value:"buddy_feed",children:(0,R.jsx)(d.l,{label:c.ag.get("buddy-feed.friend-activity"),className:s,children:(0,R.jsxs)(as,{page:v?1:0,children:[(0,R.jsx)("div",{className:ve,children:(0,R.jsx)(he,{onBackButtonClick:C,feedIsEmpty:w,goToAddFriends:v})}),(0,R.jsxs)("div",{className:ke,children:[(0,R.jsxs)(o.K,{children:[(0,R.jsx)(u.V,{title:c.ag.get("buddy-feed.friend-activity"),panel:m.s.BuddyFeed,onClose:E,actions:!j&&(0,R.jsx)(g._,{label:c.ag.get("buddy-feed.add-friends"),children:(0,R.jsx)(h.E,{ariaLabel:c.ag.get("buddy-feed.add-friends"),testId:"add-friends-button",size:"sm",onClick:C,icon:a.t})})}),(0,R.jsx)("div",{className:_e,children:(0,R.jsx)(h.E,{ariaLabel:c.ag.get("buddy-feed.add-friends"),className:Be,size:"sm",onClick:C,icon:a.t})}),w?(0,R.jsx)(Qe,{}):(0,R.jsx)(Ts,{friends:y,spec:N})]}),j&&(0,R.jsx)("div",{className:pe,children:(0,R.jsx)(n.P,{className:Ne,"data-testid":"add-friends-button",buttonSize:"sm",onClick:C,title:c.ag.get("buddy-feed.find-friends"),children:c.ag.get("buddy-feed.find-friends")})})]})]})})})}}}]);
//# sourceMappingURL=xpui-routes-buddy-feed.js.map