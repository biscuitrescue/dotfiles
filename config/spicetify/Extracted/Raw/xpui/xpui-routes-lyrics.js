"use strict";(("undefined"!=typeof self?self:global).webpackChunkopen=("undefined"!=typeof self?self:global).webpackChunkopen||[]).push([[6025],{22578:(e,r,i)=>{i.d(r,{$:()=>y});var t=i(64593),s=i(96206),a=i(69691),n=i(8341),c=i(89952),o=i(67294),l=i(51615),d=i(24183);var u=i(85893);function m(e){return e.includes("Spotify")?e:`Spotify – ${e}`}const y=({children:e,usePlayingItem:r})=>{let i=m(e);(e=>{const{mainLandmarkRef:r}=(0,d.Oh)(),i=(0,l.k6)(),t=i.location?.state?.preventMoveFocus,s=(0,o.useRef)(i.length<2);s.current=i.length<2,(0,o.useEffect)((()=>{const i=r.current;!t&&!s.current&&i&&e&&(i.setAttribute("aria-label",e),i.focus())}),[e,r,t])})(e);const{isPlaying:y}=(0,a.IK)(),g=(0,n.Y)((e=>e?.item));return g&&(y||r)&&((0,c.G_)(g)?i=[g.name,g.artists.map((e=>e.name)).join(s.ag.getSeparator())].join(" • "):(0,c.iw)(g)?i=[g.name,g.show.name].join(" • "):(0,c.k6)(g)&&(i=m(s.ag.get("ad-formats.advertisement")))),(0,u.jsx)(t.q,{defaultTitle:"Spotify",defer:!1,children:(0,u.jsx)("title",{children:i})})}},70369:(e,r,i)=>{i.d(r,{$:()=>t.$});var t=i(22578)},48856:(e,r,i)=>{i.r(r),i.d(r,{default:()=>Ne});var t=i(76542),s=i(86706),a=i(69518),n=i.n(a),c=i(73012),o=i(87577),l=i(37081),d=i(49207),u=i(48015),m=i(39270),y=i(8341),g=i(55799),v=i(49104),p=i(70369),f=i(57451),h=i(88767),b=i(96511);var x=i(68120);function S(e,r,i){const{startTimeMs:t,words:s}=e,a=i[r+1];return{start:t||0,end:a&&a.startTimeMs?a.startTimeMs:1/0,text:s}}function k(e){const r=function(e){return{r:e>>16&255,g:e>>8&255,b:255&e}}(e);return u.I.fromRGB(r).toCSS(u.j.RGB)}const L=(e,r,i=!1)=>{const t=["lyrics",{uri:e,image:r,vocalRemoval:i}],{data:s,isLoading:a,isError:c}=(0,h.useQuery)(t,(async()=>e&&r&&n().isTrack(e)?await async function(e,r,i){try{const a=await(0,x.S)(e,r,i);return{hasLyrics:!0,isTimeSynced:(s=a.lyrics.syncType,"LINE_SYNCED"===s||"SYLLABLE_SYNCED"===s),syncType:a.lyrics.syncType,lyrics:a.lyrics.lines.map(S),colors:(t=a.colors,{text:k(t.text),activeText:k(t.highlightText),background:k(t.background)}),provider:a.lyrics.provider,providerDisplayName:a.lyrics.providerDisplayName,providerLyricsId:a.lyrics.providerLyricsId,hasVocalRemoval:a.hasVocalRemoval??!1}}catch(e){if(e instanceof b.m&&404===e.status)return{hasLyrics:!1};throw e}var t,s}(e,r,i):{hasLyrics:!1}),{cacheTime:18e5});return{data:s??null,loading:a,error:c}};var j=i(67294),N=i(81898),T=i(23716),I=i(15852),C=i(32667),w=i(96206),D=i(52759);const E={start:0,end:1,text:""};var O=i(24643),B=i(8271);var F=i(97650),_=i(32648);const A="lyrics-lyricsContent-lyric",V="lyrics-lyricsContent-active",G="lyrics-lyricsContent-highlight",R="lyrics-lyricsContent-unsynced",U="lyrics-lyricsContent-provider",z="lyrics-lyricsContent-description";var H=i(85893);const M=j.memo((function({onObserve:e,text:r,lineNumber:i,activeLineIndex:s,isTimeSynced:a,onClick:n}){const{ref:c,inView:o}=(0,F.YD)({threshold:0,triggerOnce:!0});(0,j.useEffect)((()=>{o&&e(r)}),[o,e,r]);const l=(0,j.useRef)(),d=(0,j.useRef)(!0),u=(0,j.useContext)(_.VX);(0,j.useEffect)((()=>{if(a&&s===i||a&&0===i&&s<0){const e=l.current?.getBoundingClientRect().top,r=u.scrollNodeRef.current?.getBoundingClientRect().height,i=r/4;if((e<i||e>r-i)&&!d.current&&s>=0)return;const t=d.current?"auto":"smooth";l.current?.scrollIntoView({behavior:t,block:"center",inline:"center"})}d.current=!1}),[s,a,i,l,u]);const m=(0,j.useCallback)((e=>{c(e),l.current=e||void 0}),[c]);return(0,H.jsx)("div",{dir:"auto",className:(0,t.cx)(A,{[V]:s===i,[G]:s>i,[R]:!a}),"data-testid":"fullscreen-lyric",ref:m,onClick:n,children:r})})),Y=j.memo((function({trackUri:e,data:r,format:i,onLineClick:t}){const{provider:s,providerLyricsId:a,providerDisplayName:n,syncType:c,isTimeSynced:o}=r,{lyricWithEmptyLines:l,activeLineIndex:d}=((e,r)=>{const{lyrics:i=[],isTimeSynced:t}=r,[s]=(0,D.z)(500,(r=>r?.item?.uri===e)),a=(0,j.useMemo)((()=>[E,E,...i].map(((e,r)=>({...e,lineNumber:r})))),[i]),n=t?a.findIndex((({start:e,end:r})=>s>=e&&s<r)):-1;return{lyricWithEmptyLines:a,activeLineIndex:n}})(e,r),u=function(e){const{trackUri:r,format:i,provider:t,providerLyricsId:s,syncType:a}=e,[n,c]=(0,j.useState)(!1),[o,l]=(0,j.useState)(0),d=(0,y.Y)((e=>e?.playbackId??void 0)),u=(0,j.useMemo)((()=>(0,O.N)({lyrics_format:i,track_uri:r,provider:t,provider_lyrics_id:s,sync_type:a,playback_id:d})),[i,t,s,a,r,d]);(0,j.useEffect)((()=>{c(!1),l(0)}),[u]);const m=(0,B.s4)();return(0,j.useEffect)((()=>{n||o>=140&&(m.send(u),c(!0))}),[o,n,u,m]),(0,j.useCallback)((e=>{e.length>1&&l((r=>r+e.length))}),[l])}({trackUri:e,format:i,provider:s,providerLyricsId:a,syncType:c});return(0,H.jsxs)(H.Fragment,{children:[!o&&(0,H.jsx)(C.D,{as:"p",variant:"mesto",className:z,dir:"auto",children:w.ag.get("web-player.lyrics.unsynced")}),l.map((({text:e,lineNumber:r})=>(0,H.jsx)(M,{text:e,lineNumber:r,activeLineIndex:d,isTimeSynced:o,onObserve:u,onClick:e=>t?.(e,l[r].start,o)},r))),n&&(0,H.jsx)(C.D,{as:"p",variant:"mesto",className:U,dir:"auto",children:w.ag.get("web-player.lyrics.providedBy",n)})]})})),q="lyrics-lyrics-contentContainer",J="lyrics-lyrics-contentWrapper",P=({trackUri:e,data:r})=>{const{spec:i,logger:t}=(0,I.fU)(N.createDesktopLyricsEventFactory,{data:{uri:e}}),s=(0,T.g)(),a=(0,j.useCallback)(((e,r,a)=>{if(a){const a=i.lyricsLineFactory().hitSeekToTime({msToSeekTo:r});t.logInteraction(a);e.target.scrollIntoView({behavior:"smooth",block:"center",inline:"center"}),s.seekTo(r);const n=s.getState();n&&!n.isPaused||s.resume()}}),[t,s,i]);return(0,H.jsx)("div",{className:q,children:(0,H.jsx)("div",{className:J,children:(0,H.jsx)(Y,{trackUri:e,data:r,format:"fullscreen",onLineClick:a},e)})})};var W=i(38470);const Z="oNqyFdyc0Z01aWTF8qtF",$="C3pBU1DsOUJJOAv89ZFT",K=(0,j.memo)((function({version:e}){const r=[w.ag.get("web-player.lyrics.noLyrics0"),w.ag.get("web-player.lyrics.noLyrics1"),w.ag.get("web-player.lyrics.noLyrics2"),w.ag.get("web-player.lyrics.noLyrics3")];let i;switch(e){case"ad":i=w.ag.get("web-player.lyrics.ad");break;case"error":i=w.ag.get("web-player.lyrics.error");break;case"unavailable":i=r[Math.floor(Math.random()*r.length)];break;default:(0,W.U)(e)}return(0,H.jsx)("div",{className:Z,children:(0,H.jsx)("span",{className:$,children:i})})}));var Q=i(94184),X=i.n(Q),ee=i(92949),re=i(96314),ie=i(21864),te=i(64570),se=i(34142),ae=i(47921),ne=i(32626),ce=i(30005),oe=i(36652),le=i(21691),de=i(66587);const ue="qnJd7AVNVGM33NxaibzG",me="tPJJwfJAQV0WDsE9Kfmd",ye=[{volume:de.B.SING_ALONG_OFF,icon:(0,H.jsx)(ee.D,{iconSize:16}),get label(){return w.ag.get("singalong.off")}},{volume:de.B.HIGH,icon:(0,H.jsx)(re.d,{iconSize:16}),get label(){return w.ag.get("singalong.more-vocal")}},{volume:de.B.LOW,icon:(0,H.jsx)(ie.J,{iconSize:16}),get label(){return w.ag.get("singalong.less-vocal")}}],ge=j.memo((function({currentTrackUri:e}){const{isSupported:r,volume:i,setVocalVolume:t}=(e=>{const r=(0,g.$)(),[i,t]=(0,j.useState)(de.B.SING_ALONG_OFF),{isSupported:s}=r.getCapabilities();return(0,j.useEffect)((()=>{r.setStatus(de.q.DISABLED).then((()=>{t(de.B.SING_ALONG_OFF)}))}),[e,r]),(0,j.useEffect)((()=>()=>{r.setStatus(de.q.DISABLED)}),[r]),{isSupported:s,volume:i,setVocalVolume:(0,j.useCallback)((async e=>{e===de.B.SING_ALONG_OFF?await r.setStatus(de.q.DISABLED):await r.setStatus(de.q.ENABLED),await r.setVocalVolume(e),t(e)}),[r])}})(e),s=(0,j.useCallback)((e=>{r&&t(e.volume)}),[r,t]);if(!r)return null;const a=ye.find((e=>e.volume===i)),n=a?.volume===de.B.SING_ALONG_OFF;return(0,H.jsx)(ne.yj,{menu:(0,H.jsxs)(ce.v,{children:[(0,H.jsx)(oe.F,{children:w.ag.get("singalong.title")}),ye.map((e=>(0,H.jsx)(le.s,{role:"menuitemradio","aria-checked":i===e.volume,"aria-label":e.label,onClick:()=>s(e),icon:e.icon,iconPosition:"leading",children:e.label},e.volume)))]}),children:(e,r,i)=>(0,H.jsxs)("button",{onClick:r,ref:i,type:"button",className:X()(ue,{[me]:n}),children:[n?(0,H.jsxs)(H.Fragment,{children:[(0,H.jsx)(te.r,{iconSize:16}),(0,H.jsx)(C.D,{variant:"mesto",children:w.ag.get("singalong.button")})]}):(0,H.jsxs)(H.Fragment,{children:[a.icon,(0,H.jsx)(C.D,{variant:"mesto",children:a.label})]}),e?(0,H.jsx)(se.U,{iconSize:16}):(0,H.jsx)(ae.i,{iconSize:16})]})})})),ve="lyrics-lyrics-container",pe="iKgf4UDhbRTHxmZSuAEc",fe="DADZePCqi2OVZpayspK_",he="lyrics-lyrics-background",be="SaEkeiyzAoXnWVSDiTR7",xe=(0,H.jsx)("div",{className:fe,children:(0,H.jsx)(f.H,{})}),Se=(0,H.jsx)(K,{version:"error"}),ke=(0,H.jsx)(K,{version:"ad"}),Le=(0,H.jsx)(K,{version:"unavailable"}),je={active:c.ixZ,inactive:c.Snx,passed:c.Snx,background:c.tGJ,messaging:c.ixZ},Ne=()=>{const e=(0,g.$)(),{isSupported:r}=e.getCapabilities(),i=(0,o.W6)(d.cp)&&r,a=(0,m.O)(),c=(0,y.Y)((e=>e?.item),((e,r)=>e?.uri===r?.uri)),f=c?.uri||"",h=(0,v.o)(c?.images||void 0,{desiredLabel:"large",desiredSize:600}),{data:b,loading:x,error:S}=L(f,h||c?.images?.[0]?.url||"",i);let k=je;b?.hasLyrics&&(k={active:b.colors.activeText,inactive:b.colors.text,passed:u.I.fromCSS(b.colors.activeText,.7).toCSS(u.j.RGBA),background:b.colors.background,messaging:b.colors.text}),(0,l.Y)(k.background,je.background);const j=(0,y.Y)((e=>e?.nextItems?.[0]),((e,r)=>e?.uri===r?.uri));L(j?.uri||"",j?.images?.[0]?.url||"",i);let N=xe,T=!1;if(f)if(n().isAd(f))N=ke;else if(S)N=Se;else if(x)N=xe;else if(b)if(b.hasLyrics){const e=a.activeDevice?.isLocal??!1;T=i&&b.hasVocalRemoval&&e,N=(0,H.jsx)(P,{trackUri:f,data:b})}else N=Le;const I=(0,s.v9)((e=>e.ads.leaderboard.isEnabled)),C={"--lyrics-color-active":k.active,"--lyrics-color-inactive":k.inactive,"--lyrics-color-passed":k.passed,"--lyrics-color-background":k.background,"--lyrics-color-messaging":k.messaging};return(0,H.jsxs)(H.Fragment,{children:[(0,H.jsx)(p.$,{usePlayingItem:!0,children:"Spotify"}),(0,H.jsxs)("div",{className:(0,t.cx)(ve,{[pe]:I}),style:C,children:[(0,H.jsx)("div",{className:he}),N,T?(0,H.jsx)("div",{className:be,children:(0,H.jsx)(ge,{currentTrackUri:f})}):null]})]})}}}]);
//# sourceMappingURL=xpui-routes-lyrics.js.map